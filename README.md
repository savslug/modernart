Simple Modern Art Protocol
====

競りゲームの傑作「モダンアート」を単純化し、ソケット通信でAI同士の対戦ができるようにしたものです。
サーバーと、通信周りの面倒ごとを処理済みのPythonクライアントテンプレートが入っています。

## デモ

5人、微妙に賢いエージェントの対戦。

<img src="/image/modern.gif?raw=true">

## とりあえず試したい

    git clone https://github.com/calups/modernart_protocol
    cd modernart_protocol
    python Server/SimpleModernArt.py &
    # 接続準備が整うのを待ってから
    ./5mura.sh

サーバーとサンプルエージェント5体が立ち上がります。

## シンプルモダンアート

プレイ（と実装）を簡単にするため、ルールを単純にしました。
正規ルール版もいずれ作るかもしれません。

### ルール（知ってる人向け）

- 競りの種類が「入札」（握り込み）だけに。
- 当然ダブルオークションもない。
- 所持金が公開情報に。正規ルールでも正確にカウンティングすればわかってしまうため。
- プレイヤー間での会話は不可。出品する絵と入札金額で想いを伝えよう。

上記4点以外は正規のルールと全く同じです。
3人プレイ用の選択ルール、ダブルオークションに関する選択ルールは使用しません。

### ルール（知らない人向け）

長いのでREADME最下部に記載します。

## 必要環境

Python3で動作確認。
特別なモジュールは必要ない（はず）

## エージェントの作り方

sample_agent.pyの関数を書き換えて自分だけのモダンアートエージェントを作りましょう。
値を返す必要がある関数はsellとbidだけです。

sellは自分の出品ターンが回ってきた時にどの絵を出すか、
bidは出品された絵に対していくらで入札するかを返します。

ソケット通信部分を実装すれば、Python以外のエージェントも接続可能です。

## 通信方法の概要

基本的にクライアントへの通信は以下のjson形式になっています。
文字列から起こすライブラリを使って復元してください。

    {
        'request': REQUEST
        'arg': ARG
        'info': INFO
    }

requestにはINITIALIZE、SELL、BIDなど、どんな処理を要求しているかが格納されています。

argにはrequestごとに異なる種類の情報が格納されています。
例えばPURCHASEならば誰が何をいくらで誰から落札したのかと各プレイヤーの入札金額、
ROUNDOVERならば清算金額などがわかります。

infoにはその他の公開情報が格納されています。手札、場に出ている絵の数や所持金はここから確認できます。

サーバーへの返答は全て、単に非負整数一つを返すだけで済みます。
SELLでは絵の番号(0,1,2,3,4)を、BIDでは入札額を送ってください。

なお、手札にない絵を選択した場合は手札からランダムで勝手に出品されます。
入札額は0から所持金全額の範囲でクランプされます。

## infoについて

大抵のリクエストで送られてくるinfoには、以下の形式でゲーム情報が格納されています。

    info = {
            "player_size": player_size,
            "total_paintings": [12, 13, 14, 15, 16],
            "base_value": [0, 0, 0, 0, 0], #これまでの累積価値。
            "remaining_round": 4, #残りラウンドの数。
            "turn_player": 0,
            "purchased_paintings": [], #このラウンドで購入された絵。購入順に格納される。
            "player": [{ #各プレイヤーのデータが格納される。
                "id": i,
                "cash": 100,
                "hand": [], #手札。自分以外の手札はintで枚数だけ与えられる。
                "purchased": [] #このラウンドの購入済みの絵。
            } for i in range(player_size)],
        }

## シンプルモダンアートのルール

### 目標
あなたは美術館の競売人です。手札の絵画を売り捌き、
高騰が見込める絵画を買い付けることでバリバリ儲けましょう！

ゲームは4ラウンド行われ、終了時に所持金が最も多いプレイヤーが勝利します。

### スタートアップ

#### 現金
各プレイヤーはゲーム開始時に$100,000(100金)を受け取ります。
所持金を上回る入札はできません。また、入札額は$1,000(1金)単位になります。

#### 絵画

5人の作家による絵が合計で70枚あります。
0番の作家の絵は12枚、1番は13枚、...4番は16枚存在します。

絵画はゲーム開始時と第2、第3ラウンド開始時に補充されます。
最終ラウンド前には補充されません。

手札の補充枚数はプレイヤー人数によって異なり、以下の表に基づいて決定されます。

|     | 1R  | 2R  | 3R  | 4R  |
| --- | --- | --- | --- | --- |
| 3人 | 10  | 6   | 6   | 0   |
| 4人 | 9   | 4   | 4   | 0   |
| 5人 | 8   | 3   | 3   | 0   |

##### 手札と場札

プレイヤーが絵画を保有する領域には「手札」と「場札」の2つがあります。

手札は未出品の秘蔵品であり、これが直接金に化けることはありません。

手札から出品された絵画を購入すると、絵画は買い手の場札になります。場札は手札ではないので、ここから出品することはできません。また、たとえその価値が0になろうとも、そのラウンド終了時に全ての場札が清算されます。

### ラウンド
各ラウンドでは以下の手順を繰り返します。

- SELL: 手番プレイヤーが手札から絵画を一枚出品する。手番は左のプレイヤーへ移る。
- ラウンド終了判定: ある画家の「このラウンドで5枚目となる絵画」が出品された場合、即座にラウンドが終了する。この5枚目の絵画は誰のものにもならず破棄される。
- BID: 出品された絵画に対し全員が同時に入札額を提示し、最高額を提示したプレイヤーが落札する。

#### オークションの詳細ルール

- 最高額を提示したプレイヤーが買い手となり、売り手との間で金銭と絵画の授受を行います。
- 最高額入札者が複数いた場合、売り手の左隣のプレイヤーから順に優先権を持ちます。
- 売り手が買い手になった場合、売り手は絵画を受け取り、提示した金額を銀行へ支払います。
- $0の入札は権利の放棄を意味します。ただし、全員が権利を放棄した場合、出品者が無料でその絵画を受け取ります。

### 絵画の清算

ラウンドが終わると、そのラウンドで購入した絵画の清算が行われます。
清算額は以下のルールに従って決定されます。

#### 画家の順位付け

このラウンドで出品された枚数の多い順に画家の順位が決定します。
同率の画家がいた場合、0番の画家から順に順位が与えられます。（絵画の絶対数が少ないため）

1位から3位の画家の絵はこの清算で価値を持ちます。それ以外の購入済み絵画は紙切れになります。

#### 清算

1位の絵には30、2位の絵には20、3位の絵には10の価値が与えられます。
ただし、実際の清算額にはこれまでのラウンドの累積価値が加算されます。

つまり、第一ラウンドで30、第二ラウンドで30の価値を得た画家の絵画に第四ラウンドで20の価値が付いた場合、
その精算額は1枚あたり80ということになります。

逆に、これまでのラウンドでどれだけの価値がついていようと、このラウンドで3位以内に入らなかった絵は$0で清算されます。

最終ラウンドでなければ、購入済み絵画を全て清算し次のラウンドに進みます。

### ゲームの終了

第四ラウンドの清算を以ってゲームが終了します。その時点で最高額の現金を所有しているプレイヤーの優勝です。
同数だった場合は勝利を分かち合います。（単独勝利と同等の扱いとします。）


### 正規ルール

http://www.newgamesorder.jp/games/modernart
の下の方にあるモダンアート.pdfから正規のルール説明書をダウンロードできます。

が、できたら買ってリアルで遊んでいただけるといちモダンアートファンとして嬉しいです。正規ルールには色んな競り方法（特にダブルオークション）があって本当に面白いので...

コンポーネントも素敵です。最小単位が$1,000の大量のチップと、画家ごとに特徴のある絵画は必見です。


## 最後に

### お願い

バグなどありましたら教えてください。

興味を持ってくださる人が一定数いたら、シンプルモダンアートAI大会を開催したいです。

### 感謝

人狼知能プロトコル(http://aiwolf.org/protocol)

及び、その公認Pythonパッケージである
AIWolfPy
(https://github.com/k-harada/AIWolfPy)

を参考にさせていただきました。ありがとうございます。
